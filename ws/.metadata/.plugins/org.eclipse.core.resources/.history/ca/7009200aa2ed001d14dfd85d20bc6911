package concesionario.model;

import java.time.LocalDate;
import java.time.LocalDateTime;
import java.util.ArrayList;

import concesionario.exceptions.AdministradorException;
import concesionario.exceptions.EmpleadoException;

public class Administrador {
	private String nombre;
	private String apellido;
	private String usuario;
	private String contrasena;
	private Empleado empleado;
	private ArrayList<Empleado> listaEmpleados;

	public Administrador(String nombre, String apellido, String usuario, String contrasena, Empleado empleado,
			ArrayList<Empleado> listaEmpleados) {
		super();
		this.nombre = nombre;
		this.apellido = apellido;
		this.usuario = usuario;
		this.contrasena = contrasena;
		this.empleado = empleado;
		this.listaEmpleados = listaEmpleados;
	}

	public String getNombre() {
		return nombre;
	}

	public void setNombre(String nombre) {
		this.nombre = nombre;
	}

	public String getApellido() {
		return apellido;
	}

	public void setApellido(String apellido) {
		this.apellido = apellido;
	}

	public String getUsuario() {
		return usuario;
	}

	public void setUsuario(String usuario) {
		this.usuario = usuario;
	}

	public String getContrasena() {
		return contrasena;
	}

	public void setContrasena(String contrasena) {
		this.contrasena = contrasena;
	}

	public Empleado getEmpleado() {
		return empleado;
	}

	public void setEmpleado(Empleado empleado) {
		this.empleado = empleado;
	}

	public ArrayList<Empleado> getListaEmpleados() {
		return listaEmpleados;
	}

	public void setListaEmpleados(ArrayList<Empleado> listaEmpleados) {
		this.listaEmpleados = listaEmpleados;
	}

	public void verReportes(LocalDateTime fechaInicio, LocalDateTime fechaFin) {
		// Código para ver reportes de negocios realizados por cada uno de los
		// empleados en un periodo de tiempo dado
	}

	public void recuperarContrasena(String usuario, String respuestaSeguridad, String nuevaContrasena)
			throws EmpleadoException {
		Empleado empleadoEncontrado = buscarEmpleado(usuario);
		if (empleadoEncontrado == null) {
			throw new EmpleadoException("El empleado no está registrado");
		}

		// Verificar respuesta de seguridad
		if (!empleadoEncontrado.getRespuestaSeguridad().equals(respuestaSeguridad)) {
			throw new EmpleadoException("Respuesta de seguridad incorrecta");
		}

		// Cambiar contraseña
		empleadoEncontrado.setContrasena(nuevaContrasena);
	}

	public String registrarEmpleado(String nombre, String apellido, String usuario, String contrasena,
			String idEmpleado, String contrasenaAdministrador) throws AdministradorException {
		// Verificar identidad del administrador
		if (!this.contrasena.equals(contrasenaAdministrador)) {
			throw new AdministradorException("Contraseña del Administrador incorrecta");
		}

		String mensaje = "El empleado ha sido registrado";
		boolean empleadoEncontrado = verificarEmpleado(usuario);
		if (empleadoEncontrado == true) {
			throw new AdministradorException("El empleado ya existe");
		} else {
			Empleado nuevoEmpleado = new Empleado(nombre, apellido, usuario, contrasena, idEmpleado);
			listaEmpleados.add(nuevoEmpleado);
		}
		return mensaje;
	}

	private boolean verificarEmpleado(String idEmpleado) {
		boolean verificado = false;
		for (Empleado empleado : listaEmpleados) {

			if (empleado.getIdEmpleado().equals(idEmpleado)) {
				verificado = true;
				return verificado;
			}

		}
		return verificado;

	}

	public String actualizarEmpleado(String nombre, String apellido, String usuario, String contrasena,
			 String correoElectronico, String idEmpleado)
			throws EmpleadoException {
		Empleado empleadoEncontrado = buscarEmpleado(idEmpleado);
		if (empleadoEncontrado == null) {
			throw new EmpleadoException("El empleado no está registrado");
		}

		empleadoEncontrado.setNombre(nombre);
		empleadoEncontrado.setApellido(apellido);
		empleadoEncontrado.setUsuario(usuario);
		empleadoEncontrado.setContrasena(contrasena);
		empleadoEncontrado.setCorreoElectronico(correoElectronico);


		return "El empleado ha sido actualizado";
	}

	public String eliminarEmpleado(String idEmpleado) throws EmpleadoException {
		Empleado empleadoEncontrado = buscarEmpleado(idEmpleado);
		if (empleadoEncontrado == null) {
			throw new EmpleadoException("El empleado no está registrado");
		}

		listaEmpleados.remove(empleadoEncontrado);

		return "El empleado ha sido eliminado";
	}

	public Empleado buscarEmpleado(String idEmpleado) {

		Empleado empleadoEncontrado = null;

		for (Empleado empleado : listaEmpleados) {
			if (empleado.getIdEmpleado().equals(idEmpleado)) {
				empleadoEncontrado = empleado;
			}
		}
		return empleadoEncontrado;
	}

	public void bloquearCuentaEmpleado(String idEmpleado) throws EmpleadoException {
		Empleado empleadoEncontrado = buscarEmpleado(idEmpleado);
		if (empleadoEncontrado == null) {
			throw new EmpleadoException("El empleado no está registrado");
		}
		empleadoEncontrado.setCuentaBloqueada(true);
	}

	public void desbloquearCuentaEmpleado(String idEmpleado) throws EmpleadoException {
		Empleado empleadoEncontrado = buscarEmpleado(idEmpleado);
		if (empleadoEncontrado == null) {
			throw new EmpleadoException("El empleado no está registrado");
		}
		empleadoEncontrado.setCuentaBloqueada(false);
	}

	public String generarCredenciales(String nombreEmpleado, String idEmpleado) throws EmpleadoException {
		Empleado empleadoEncontrado = buscarEmpleado(idEmpleado);
		if (empleadoEncontrado == null) {
			throw new EmpleadoException("El empleado no está registrado");
		}

		String credenciales = "Usuario: " + empleadoEncontrado.getUsuario() + ", Contraseña: "
				+ empleadoEncontrado.getContrasena();
		return credenciales;
	}

	public void cambiarContrasenaEmpleado(String idEmpleado, String nuevaContrasena) throws EmpleadoException {
		Empleado empleadoEncontrado = buscarEmpleado(idEmpleado);
		if (empleadoEncontrado == null) {
			throw new EmpleadoException("El empleado no está registrado");
		}
		empleadoEncontrado.setContrasena(nuevaContrasena);
	}

}
